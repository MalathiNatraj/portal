@{
    ViewBag.Title = "MAS";
}

<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />

	<!-- Set the viewport width to device width for mobile -->
	<meta name="viewport" content="width=320,user-scalable=false" />
    <script src="@Url.Content("~/Scripts/jquery.blockUI.js")" type="text/javascript"></script>
      <link href="@Url.Content("~/Content/kendo.dataviz.min.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/kendo.dataviz.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/kendo.aspnetmvc.min.js")" type="text/javascript"></script>
    <link rel="stylesheet" href="@Url.Content("~/Content/kendo.common.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Content/kendo.default.min.css")" />
    <script src="@Url.Content("~/Scripts/jquery.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/kendo.web.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-1.9.1.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/nav/multilevel.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/nav/responder.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/nav/slider.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/app/Common.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.blockUI.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/app/BlockUIForms.js")" type="text/javascript"></script>
    <link href="@Url.Content("~/Content/BlockUIForms.css")" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../Content/style.css">
    <!--[if gte IE 9]>
        <link rel="stylesheet" type="text/css" href="css/gradient-ie6-and-up.css" />
	<![endif]-->

	<title>Diebold</title>
    <script src="@Url.Content("~/Scripts/app/Common.js")" type="text/javascript"></script>
	<script type="text/javascript">
<!--
	    var SelectedSiteId;
	    var SelectedTimeDuration;
	    var SelectedAccountNumber;
	    function MM_swapImgRestore() { //v3.0
	        var i, x, a = document.MM_sr; for (i = 0; a && i < a.length && (x = a[i]) && x.oSrc; i++) x.src = x.oSrc;
	    }
	    function MM_preloadImages() { //v3.0
	        var d = document; if (d.images) {
	            if (!d.MM_p) d.MM_p = new Array();
	            var i, j = d.MM_p.length, a = MM_preloadImages.arguments; for (i = 0; i < a.length; i++)
	                if (a[i].indexOf("#") != 0) { d.MM_p[j] = new Image; d.MM_p[j++].src = a[i]; }
	        }
	    }

	    function MM_findObj(n, d) { //v4.01
	        var p, i, x; if (!d) d = document; if ((p = n.indexOf("?")) > 0 && parent.frames.length) {
	            d = parent.frames[n.substring(p + 1)].document; n = n.substring(0, p);
	        }
	        if (!(x = d[n]) && d.all) x = d.all[n]; for (i = 0; !x && i < d.forms.length; i++) x = d.forms[i][n];
	        for (i = 0; !x && d.layers && i < d.layers.length; i++) x = MM_findObj(n, d.layers[i].document);
	        if (!x && d.getElementById) x = d.getElementById(n); return x;
	    }

	    function MM_swapImage() { //v3.0
	        var i, j = 0, x, a = MM_swapImage.arguments; document.MM_sr = new Array; for (i = 0; i < (a.length - 2); i += 3)
	            if ((x = MM_findObj(a[i])) != null) { document.MM_sr[j++] = x; if (!x.oSrc) x.oSrc = x.src; x.src = a[i + 2]; }
	    }

	    $(document).ready(function () {
	        loadMonitoringdevice();
	    });

	    function loadMonitoringdevice() {
	        $.ajax({
	            url: '@Url.Action("GetAccountList", "PortletsDefault")',
	            type: 'GET',
	            success: function (data) {
	                $('#MASAccountList').val('');
	                $.each(data, function (index, itemData) {
	                    $('#MASAccountList').append($('<option/>', {
	                        value: itemData.Id,
	                        text: itemData.Name + ' : ' + itemData.AccountNumber
	                    })

                        );
	                });
	            },
	            error: function (errordata) {
	                alert('Failure')
	            }
	        });

	        $.ajax({
	            url: '@Url.Action("GetTestDuration", "PortletsDefault")',
	            type: 'GET',
	            success: function (data) {
	                $('#MASTestDuration').val('');
	                $.each(data, function (index, itemData) {
	                    $('#MASTestDuration').append($('<option/>', {
	                        value: itemData.Value,
	                        text: itemData.Text
	                    })

                        );
	                });
	            },
	            error: function (errordata) {
	                alert('Failure')
	            }
	        });

	        $('#MASAccountList').change(function () {
	            // BlockElement("dvMASMobile", 'Connecting...');
	            document.getElementById('btnPlaceonTest').innerHTML = 'Place on Test';
	            var SiteId = $("#MASAccountList").val();
	            SelectedSiteId = SiteId;
	            var selectedMASInfo = $("#MASAccountList").select();
	            if (SelectedSiteId != 'undefined' && SelectedSiteId != null && SelectedSiteId != '') {
	                var selAcc = this.options[this.selectedIndex].text;
	                var selectedAccNumber = selAcc.split(":");
	                if (selectedAccNumber.length == 2) {
	                    $("#lblAccountNumber").text(selectedAccNumber[selectedAccNumber.length - 1]);
	                    SelectedAccountNumber = selectedAccNumber[selectedAccNumber.length - 1].trim();
	                }
	            }
	            if (SiteId != null && SiteId != undefined && SiteId != '' && SiteId != 'Select Account') {
	                GetSiteDetails(SiteId);
	            }
	            if (SelectedSiteId != 'undefined' && SelectedSiteId != null && SelectedSiteId != '') {
	                var SelectedHrs = 0;
	                var Resultset = {
	                    'SelectedSite': SelectedSiteId,
	                    'SelectedHour': SelectedHrs,
	                    'AccountNumber': SelectedAccountNumber
	                };
	                var MobileDDChangePlaceonTestUrl = '@Url.Action("PlaceonTestDDChange", "PortletsDefault")';
	                $.post(MobileDDChangePlaceonTestUrl, Resultset, MobilePlaceonTestCallbackforDDChange, "json");
	            }
	            //else
	            // UnBlockElement("dvMASMobile");
	        });

	        function MobilePlaceonTestCallbackforDDChange(result) {
	            if (result != null && result != undefined) {
	                if (result.Message != null && result.Message != undefined && result.Message != "") {
	                    alert(result.Message);	                    
	                }
	                else {
	                    if (result == 'Exists') {
	                        document.getElementById('btnPlaceonTest').innerHTML = 'Clear Test'
	                    }
	                    else if (result == 'NotExists') {
	                        document.getElementById('btnPlaceonTest').innerHTML = 'Place on Test'
	                    }	                    
	                }
	            }

	        }
	        function GetSiteDetails(vals) {
	            var pollingUrl = '@Url.Action("GetSiteInformationDetails", "PortletsDefault")';
	            var parameters = { "SiteId": vals };
                $.post(pollingUrl, parameters, fnSiteDetailsCallback, "json")
            }

            function fnSiteDetailsCallback(ResultSet)
            {                
                $("#lblSiteName").text(ResultSet.Name);
                $("#lblAddress1").text(ResultSet.Address);
                $("#lblCity").text(ResultSet.City);
                $("#lblState").text(ResultSet.State);
                $("#lblZip").text(ResultSet.Zip);
            }

            $('#MASTestDuration').change(function () {
                var TestDurationId = $("#MASTestDuration").val();
                if (TestDurationId != null && TestDurationId != undefined && TestDurationId != '' && TestDurationId != 'Test Duration') {
                    SelectedTimeDuration = $("#MASTestDuration").val();
                }
            });

      }
      var MASOriginalValue = "";
      function fnMASmaskpinEntry(elem) {
          if (elem.value.length < 4) {
              if (elem.value == "") {
                  MASOriginalValue = "";
                  //  alert("If null\nMASOriginalValue:"+ MASOriginalValue);                    
              }
              else if (elem.value.length < MASOriginalValue.length) {
                  MASOriginalValue = MASOriginalValue.substr(0, MASOriginalValue.length - 1);
                  // alert("If elem.value.length < MASOriginalValue.length\nMASOriginalValue:"+ MASOriginalValue);
              }
              else {
                  MASOriginalValue = MASOriginalValue + elem.value.substr(elem.value.length - 1, 1);
                  document.getElementById('txtAccessUserpinAccount').value = '';
                  for (var i = 0; i < MASOriginalValue.length; i++) {
                      document.getElementById('txtAccessUserpinAccount').value = document.getElementById('txtAccessUserpinAccount').value + "*";
                  }
              }

              document.getElementById('hdnMASMaskedPin').value = MASOriginalValue;
          } else {

              MASOriginalValue = MASOriginalValue + elem.value.substr(elem.value.length - 1, 1);
              document.getElementById('hdnMASMaskedPin').value = MASOriginalValue;
              document.getElementById('txtAccessUserpinAccount').value = document.getElementById('txtAccessUserpinAccount').value.substring(0, document.getElementById('txtAccessUserpinAccount').value.length - 1) + "*";
              return false;
          }

      }

      
//-->
    </script>
    
    <script language="javascript" type="text/javascript">
        function fnPlaceonTestClick() {            
            // User Pin Validation
            var Resultset = {
                'SelectedSite': SelectedSiteId,
                'SeletedHours': SelectedTimeDuration,
                'AccountNumber': SelectedAccountNumber
            };

            var btnPlaceonTestVal = document.getElementById('btnPlaceonTest').innerHTML;

            if (btnPlaceonTestVal == 'Clear Test') {
                var SelectedHrs = 0;
                var Resultset_Clear = {
                    'SelectedSite': SelectedSiteId,
                    'SelectedHour': SelectedTimeDuration,
                    'AccountNumber': SelectedAccountNumber
                };
                $.post(masPlaceonTestUrl, Resultset_Clear, PlaceonTestCallbackforClearTest, "json");
            }
            else {
                if (SelectedSiteId != 'undefined' && SelectedSiteId != null && SelectedSiteId != '') {
                    if (SelectedTimeDuration != 'undefined' && SelectedTimeDuration != null && SelectedTimeDuration != '') {
                        $("#UserPinWindowMAS").data("kendoWindow").center().open();
                    }
                    else {
                        alert('Please select the time duration before placing on test.');
                    }
                }
                else {
                    alert('Please select the account number before placing on test.');
                }
            }
        }

        function btnCancelUserInfoClicked() {
            $("#UserPinWindowMAS").data("kendoWindow").close();
           // $("#dvUserPinValidate").css({ "display": "none" });
            $("#txtAccessUserpinAccount").val('');
            $("#my_overlay").css({
                "display": "none",
                "visibility": "hidden"
            });
        }

        function MCancelPoT() {
            var wnd = $("#WarningMessageMAS").data("kendoWindow");
            wnd.close();
        }
        function MConfirmPoT() {            
            var url = '@Url.Action("ValidateUserPin", "PortletsDefault")';
            var UserPin = document.getElementById('hdnMASMaskedPin').value.substr(0, 6);
            document.getElementById('txtAccessUserpinAccount').value = '';
            document.getElementById('hdnMASMaskedPin').value = '';
            MASOriginalValue = "";
            var Resultset = {
                'UserPin': UserPin
            };

            if (UserPin != 'undefined' && UserPin != null && UserPin != '') {
                BlockElement("dvMASMobile", 'Connecting...');
                $.post(url, Resultset, ValidateUserPinCallback, "json");            
            }
            else {
                alert('Please enter user pin');
                UnBlockElement("dvMASMobile");
            }
            var wnd = $("#WarningMessageMAS").data("kendoWindow");
            wnd.close();
        }

        function PlaceonTestCallback(result) {
            if (result != null && result != undefined) {
                if (result.Message != null && result.Message != undefined && result.Message != "") {
                    alert(result.Message);
                    UnBlockElement("dvMASMobile");
                }
                else {
                    UnBlockElement("dvMASMobile");
                    btnCancelUserInfoClicked();
                    alert(result);
                    if (result == 'Test Successful.') {
                        document.getElementById('btnPlaceonTest').innerHTML = 'Clear Test';
                    }
                }
            }
        }
        function PlaceonTestCallbackforClearTest(result) {
            if (result != null && result != undefined) {
                if (result.Message != null && result.Message != undefined && result.Message != "") {
                    alert(result.Message);                   
                }
                else {
                    if (result == 'Test Successful.') {
                        result = 'Clear Successful'
                        document.getElementById('btnPlaceonTest').innerHTML = 'Place on Test';
                    }
                    alert(result);
                }
            }

        }

            function fnPlaceonTest() {
                // User Pin Validation
                var Resultset = {
                    'SelectedSite': SelectedSiteId,
                    'SeletedHours': SelectedTimeDuration,
                    'AccountNumber': SelectedAccountNumber
                };
                if (SelectedSiteId != 'undefined' && SelectedSiteId != null && SelectedSiteId != '') {
                   // centerViewPortDialog('#dvUserPinValidate');
                }
                else {
                    alert('Please select the account number before placing on test.');
                }
            }

            function btnValidateUserpinClicked() {                
//                var url = '@Url.Action("ValidateUserPin", "PortletsDefault")';
//                // var UserPin = document.getElementById('txtAccessUserpinAccount').value;
//                var UserPin = document.getElementById('hdnMASMaskedPin').value.substr(0, 6);
//                MASOriginalValue = "";
//                document.getElementById('txtAccessUserpinAccount').value = '';
//                document.getElementById('hdnMASMaskedPin').value = '';
//                var Resultset = {
//                    'UserPin': UserPin
//                };
//                if (UserPin != 'undefined' && UserPin != null && UserPin != '') {
//                    btnCancelUserInfoClicked();
//                    BlockElement("dvMASMobile", 'Connecting...');
//                    $.post(url, Resultset, ValidateUserPinCallback, "json");
//                }
//                else {
//                    alert('Please enter user pin');
//                    UnBlockElement("dvMASMobile");
//                }
//                $("#UserPinWindowMAS").data("kendoWindow").close();


                var UserPin = document.getElementById('hdnMASMaskedPin').value.substr(0, 6);
                var Resultset = {
                    'UserPin': UserPin
                };

                if (UserPin != 'undefined' && UserPin != null && UserPin != '' && UserPin.length > 3 && UserPin.length < 7) {
                    var wnd = $("#WarningMessageMAS").data("kendoWindow");
                    wnd.content("<p>Important!</p>" +
                    "<p style='margin-bottom:20%'>Please be aware you may be placing an account on test that contains fire detection. Certain jurisdictions or environments have laws or mandated procedures when placing an account on test that requires you to notify the local authority or provide a fire watch. Please contact your local authority if you are unsure how these apply. If you have any questions about placing an account on test please contact the Diebold monitoring center at 800-548-4478</p>" +
                    "<p style='text-align:center;'>" +
                    "<input type='button' value='Ok' style='background: none repeat scroll 0 0 #5E5E5E;border: medium none; color: #FFFFFF; cursor: pointer; font-size: 11px; font-weight: bold; margin: 0; padding: 6px 10px 6px 10px;margin-right:4px;' onclick='MConfirmPoT()'>" +
                    "<input type='button' value='Cancel' style='background: none repeat scroll 0 0 #5E5E5E;border: medium none; color: #FFFFFF; cursor: pointer; font-size: 11px; font-weight: bold; margin: 0; padding: 6px 10px 6px 10px;margin-left:5px;' onclick='MCancelPoT()'></p>");
                    wnd.center().open();
                }
                else {                                        
                    if (UserPin.length > 3 && UserPin.length < 7)
                        alert('Please enter user pin');
                    else
                        alert('Please enter a valid user pin which accepts 4 to 6 digits');
                }
            }

            function ValidateUserPinCallback(Resultant) {                
                document.getElementById('txtAccessUserpinAccount').value = "";
                MASOriginalValue = "";
                document.getElementById('hdnMASMaskedPin').value = "";
                if (Resultant != null && Resultant != undefined) {
                    if (Resultant.Message != null && Resultant.Message != undefined && Resultant.Message != "") {
                        alert(Resultant.Message);
                        UnBlockElement("dvMASMobile");
                    }
                    else {
                        if (Resultant == true) {                         
                            //centerViewPortDialog('#dvUserPinValidate');
                            var url = '@Url.Action("PlaceonTest", "PortletsDefault")';
                            var Resultset = {
                                'SelectedSite': SelectedSiteId,
                                'SeletedHours': SelectedTimeDuration,
                                'AccountNumber': SelectedAccountNumber
                            };
                            
                            if (SelectedSiteId != 'undefined' && SelectedSiteId != null && SelectedSiteId != '') {
                                if (SelectedTimeDuration != 'undefined' && SelectedTimeDuration != null && SelectedTimeDuration != '') {
                                    BlockElement("dvMASMobile", 'Connecting...');                                                                       
                                    $.post(url, Resultset, PlaceonTestCallback, "json");
                                }
                                else {
                                    alert('Please select the time duration before placing on test.');
                                }
                            }                            
                        }
                        else if (Resultant == false) {
                            alert('Invalid user pin');
                            UnBlockElement("dvMASMobile");
                        }
                    }
                }
            }
    </script>
    <style>
        .modelDialogMAS
        {
            background-color:White;
            width:50%; 
            left:330px !important;
        }
    
        .modelDialogUP 
        {
            background-color:White;
            width:30%; 
            left:400px !important;
            top:250px !important;
        }
    
        .UserPinstyle {
	        border: 1px solid;
            border-color: #C5C5C5;
        }
        
        .k-window-titlebar
        {
        	height:25px;
        }
    </style>
</head>

<body onLoad="MM_preloadImages('../../Content/images/back-btn-hovr.png')">
        <!-- Main Row Starts here -->
        <div>
                                <!--Kendo window to validate user pin-->
                                @(Html.Kendo().Window()
                                .Name("UserPinWindowMAS")
                                .Title("UserPin Validation")
                                .Visible(false)
                                .Modal(true)
                                .Content(@<text>
                                <br />
                                <div id="userpinpopup">
                                    <div>
                                        <label for="UserPin" style="margin-right:2px;">User Pin:</label>
                                       @* @Html.TextBox("txtAccessUserpinAccount", null, new { @class = "UserPinstyle", maxlength = 4 })*@
                                       <input type="tel" id="txtAccessUserpinAccount" class="UserPinstyle" maxlength="6" onkeyup="fnMASmaskpinEntry(this)"/>
                                    </div>
                                    <div class="clear">
                                    </div>
                                    <label for="UserPin" id="lblupinstatus">
                                    </label>
                                    <div style="margin: 4% 0 0 0;">
                                        <div class="add-link" align="center">
                                            <input type="button" value="Validate" id="btnUserInfoValidate" onclick="javascript:btnValidateUserpinClicked();" style="width:35%;" />
                                            <input type="button" value="Cancel" id="btnUserInfoCancel"  onclick="javascript:btnCancelUserInfoClicked();" style="width:35%;" />
                                        </div>
                                    </div>
                                </div>
                                </text>)
                                    .Draggable(false)
                                    .Width(275)
                                    .Height(200)
                                    )
                                 )

                                </div>
    <div>
     @(Html.Kendo().Window().Name("WarningMessageMAS")
    .Visible(false)
    .Title("Warning Message")
    .Modal(true)
    .Draggable(true)
    .Width(350)    
    )
    </div>
        <div class="row">
        	<div class="sixteen columns">
            	<header>
                    <div class="sixteen columns logo-small" align="center">
                    
                    	<div class="back">
                       	  <a href="../Dashboard/Home" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('back btn','','../../Content/images/back-btn-hovr.png',1)"><img src="../../Content/images/back-btn.png" name="back btn" border="0"></a>
                      </div>
                        
                    	<a href="http://www.diebold.com/dnpssec/default.htm" target="_blank"><img src="../../Content/images/logo-small.png" alt="" /></a>
	                    
                        <div class="log-out">
                        	<a href="@Url.Content("~/Account/LogOff")"><img src="../../Content/images/logout-icon.png" alt="" /></a>
                        </div>
                    </div>
				</header>
                
                <div class="clear"></div>	
                
                <!-- MAIN CONTAINER STARTS HERE -->
                <section>
                	<article>
                    <div id="dvMASMobile">
                        <div class="body-bg">
                            <div class="inner-cont">
                                
                                <!-- MONITORING PAGE STARTS HERE -->
                                <div class="monitor">
                                    <div class="main-hdr" align="center">
                                        <h1>Monitoring</h1>
                                    </div>

                                    <div class="drop-down-sel" align="center" style="margin:2% 0;">
                                        <select id="MASAccountList" name="MASAccountList">
                                            <option>Select Account</option>
                                        </select>
                                         <select id="MASTestDuration" name="MASTestDuration">
                                            <option>Test Duration</option>
                                        </select>
                                    </div>
                                    
                                    <div class="box-cont-bg">

                                        <div class="mon-cont">
                                            <p>Acct No: 
                                                <strong>
                                                    <label id="lblAccountNumber">
                                                    </label>
                                                </strong>
                                            </p>
                                            <p>Site: 
                                                <strong>
                                                    <label id="lblSiteName">
                                                    </label>
                                                </strong>
                                            </p>
                                            <p>Address: 
                                                <strong>
                                                    <label id="lblAddress1">
                                                    </label>
                                                </strong>
                                            </p>
                                            <p>City: 
                                                <strong>
                                                    <label id="lblCity">
                                                    </label>
                                                </strong>
                                            </p>
                                            <p>State: 
                                                <strong>
                                                    <label id="lblState">
                                                    </label>
                                                </strong>
                                            </p>
                                            <p>Zipcode: 
                                                <strong>
                                                    <label id="lblZip">
                                                    </label>
                                                </strong>
                                            </p>
                                        </div>

                                    </div>
                                    <div class="clear"></div>
                                    
                                    <div class="place-on-test" align="center">
                                        <p><a href="#" onclick="fnPlaceonTestClick();"><strong id="btnPlaceonTest">Place on Test</strong></a></p>
                                        <input type="hidden" id="hdnMASMaskedPin" />
                                    </div>
                                    
                                </div>
                                <!-- MONITORING PAGE ENDS HERE -->
                            
                            </div>
                        </div>
                    </div>
                    </article>
                </section>
            </div>
        </div>
        <!-- Main Row Ends here -->
	
</body>
</html>
