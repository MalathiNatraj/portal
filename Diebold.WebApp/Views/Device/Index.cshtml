@{
    ViewBag.Title = "Devices";
}
@{
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
}
<div class="headerManagemet">
    <div id="dvDevicemgmtTitle" class="pallette-detail-header-bg">
        <p>
            Device Management</p>
    </div>
    <div class="tSpace">
    </div>
    <div>
        <br />
        <p>
            @(Html.Kendo().Grid<Diebold.WebApp.Models.DeviceViewModel>()
            .Name("GrdDevice")
            .Resizable(resize => resize.Columns(true))
            .HtmlAttributes(new { style = "height: 500px" })
            .Columns(columns =>
            {
                columns.Bound(p => p.Id).Hidden();
                columns.Bound(p => p.Name).Title("Device Name");
                columns.Bound(p => p.DeviceType).Title("Device Model");
                columns.Bound(p => p.HostName).Title("Ip / Host Name");
                columns.Bound(p => p.GatewayName).Title("Gateway Name");
                columns.Bound(p => p.SiteName).Title("Site Name");
                columns.Bound(p => p.CompanyName).Title("Company Name");
                columns.Bound(p => p.ActionColumn).Filterable(false).Title("Available Actions").ClientTemplate("<a style='cursor:pointer;margin-right:4px;'><img src='" + @Url.Content("~/Content/images/icons/edit.png") + "' alt='Edit'  title='Edit' onclick='doDiagnosticAction(#=Id#,\"Edit\",\"Edit\");' /></a>" +
                                                                "# if (IsDisabled == true) { #" + "<a class='showStatusLink' style='cursor:pointer;margin-right:4px;'><img src= '" + @Url.Content("~/Content/images/icons/enable.png") + "' alt='enable' title='Enable' onclick='enableItem(#=Id#,\"Enable\",\" Enable Device\");'/></a>" +
                                                                "# } else { #" + "<a class='showStatusLink' style='cursor:pointer;margin-right:4px;'><img src= '" + @Url.Content("~/Content/images/icons/disable.png") + "' alt='disable' title='Disable' onclick='enableItem(#=Id#,\"Disable\",\" Disable Device\");' #}#</a>" +
                                                                 "<a style='cursor:pointer;margin-right:4px;'><img src='" + @Url.Content("~/Content/images/icons/delete.png") + "' alt='delete'  title='Delete' onclick='enableItem(#=Id#,\"Delete\",\" Delete Device\");'/></a>");
            })
                     .ToolBar(toolbar => toolbar.Template("<a class='k-button k-button-icontext k-grid-update' href='#' onclick='customDeviceCreate()'>Create New Device</a>"))
            .Pageable()
            .Sortable()
            .Scrollable()
            .Filterable()
            .Events(events => events.DataBound("LoadingDefaultFilter"))
            .DataSource(dataSource => dataSource
            .Ajax()
            .Read(read => read.Action("Device_Read", "Device"))
            .ServerOperation(false)
             )
                    )
        </p>
    </div>
</div>
@(Html.Kendo().Window().Name("DeviceDetails")
    .Visible(false)
    .Modal(true)
    .Draggable(true)
    .Width(300)
)
<script language="javascript" type="text/javascript">
    function customDeviceCreate() {
        var strUrl = "../Device/Create/";
        location.href = strUrl;
    }

    var bar;
    var ActPath;
    function enableItem(itemId, actionPath, title) {
        if (actionPath == "Edit") {
            ActPath = '@Url.Action("")';
        }
        else if (actionPath == "Enable") {
            ActPath = '@Url.Action("/Enable")';
        }
        else if (actionPath == "Disable") {
            ActPath = '@Url.Action("/Disable")';
        }
        else if (actionPath == "Delete") {
            ActPath = '@Url.Action("/Delete")';
        }
        bar = { item: itemId, ap: ActPath };
        var wnd = $("#DeviceDetails").data("kendoWindow");
        if (actionPath == "Delete") {
            wnd.content("<p style='height:100px'>Are you sure you want to delete this item?</p><p style='text-align:center;'>" +
                "<input type='button' value='Ok' style='background: none repeat scroll 0 0 #5E5E5E;border: medium none; color: #FFFFFF; cursor: pointer; font-size: 11px; font-weight: bold; margin: 0; padding: 6px 15px 6px 22px;margin-right:4px;' onclick='ConfirmOk(bar)'>" +
                 "<input type='button' value='Cancel' style='background: none repeat scroll 0 0 #5E5E5E;border: medium none; color: #FFFFFF; cursor: pointer; font-size: 11px; font-weight: bold; margin: 0; padding: 6px 15px 6px 22px;margin-left:5px;' onclick='ConfirmCancel()'></p>");
        }
        else {
            wnd.content("<p style='height:100px'>Do you want to continue?</p><p style='text-align:center;'>" +
                "<input type='button' value='Ok' style='background: none repeat scroll 0 0 #5E5E5E;border: medium none; color: #FFFFFF; cursor: pointer; font-size: 11px; font-weight: bold; margin: 0; padding: 6px 15px 6px 22px;margin-right:4px;' onclick='ConfirmOk(bar)'>" +
                 "<input type='button' value='Cancel' style='background: none repeat scroll 0 0 #5E5E5E;border: medium none; color: #FFFFFF; cursor: pointer; font-size: 11px; font-weight: bold; margin: 0; padding: 6px 15px 6px 22px;margin-left:5px;' onclick='ConfirmCancel()'></p>");
        }
        wnd.title(title);
        wnd.center().open();
    }
    function ConfirmCancel() {
        $("#DeviceDetails").data("kendoWindow").close();
    }
    function ConfirmOk(bar) {
        BlockElement('mainContainer', 'Connecting...');
        $("#DeviceDetails").data("kendoWindow").close();
        var data = { Id: parseInt(bar.item) };
        $.post(bar.ap, data, "json")
     .done(function (response) {         
         var grid = $("#GrdDevice").data("kendoGrid");
         grid.dataSource.read();
         UnBlockElement('mainContainer');
     })
    .fail(function (response) { alert("Error while doing the operation"); UnBlockElement('mainContainer'); });
    }

    function fngetError(data) {
        alert(data.message());
    }

    function editItem(id) {
        alert(id);
        $.ajax({
            url: '@Url.Action("/Edit")',
            type: 'POST',
            data: { Id: id },
            success: function (data) {
                fngetError(data);
            },
            error: function (errordata) {
                alert('Failure')
            }
        });
    }


    function doDiagnosticAction(itemId, actionPath, title) {
        if (actionPath == "Edit") {
            var strUrl = "../Device/Edit/" + itemId;
            location.href = strUrl;
        }
    }
</script>
<style>
     .k-block > .k-header, .k-window-titlebar
     {
        height: 1.5em;
     }
</style>